{"version":3,"file":"zx-state.umd.js","sources":["../src/index.js"],"sourcesContent":["function mapObj(orig, fn, onto) {\n    return Object.keys((orig || {})).reduce((o, name) => {\n        o[name] = fn(orig[name], name, o)\n        return o\n    }, (onto || {}))\n} \n\nfunction bindFnCollection(binder, collection, ...more) {\n    return mapObj(collection, (toBind, name, bound) => {\n        if (typeof toBind === 'function') return binder(toBind, bound, ...more)\n        return bindFnCollection(binder, toBind, ...more.map(x => x[name]))\n    })\n}\n\nfunction collectSubs(opts, prop) {\n    return mapObj(opts.sub, sub => Object.assign({}, collectSubs(sub, prop)), opts[prop])\n}\n\nexport default function (opts, notify) {\n    var pending;\n\n    const update = _ => {\n        if (pending) return\n        pending = !pending\n        setTimeout(_ => {\n           pending = !pending\n           notify && notify()\n        }, 0)\n    }\n    \n    const state = collectSubs(opts, 'state')\n\n    const actions = bindFnCollection(\n        (fn, actions, state) =>  (...args) => {\n            var data = fn(state, actions, ...args)\n            if (!data) return\n            Object.assign(state, data)\n            update()\n        },\n        collectSubs(opts, 'actions'),\n        state\n    )\n\n    const views = bindFnCollection(\n        (fn, V, S, A) => (...args) => fn(S, A, V, ...args),\n        collectSubs(opts, 'views'),\n        state,\n        actions\n    )\n\n    update()\n\n    return {actions, views}\n}\n"],"names":["mapObj","orig","fn","onto","Object","keys","reduce","o","name","bindFnCollection","binder","collection","more","toBind","bound","map","x","collectSubs","opts","prop","sub","assign","notify","pending","update","_","setTimeout","state","actions","args","data","views","V","S","A"],"mappings":"oCAAA,SAASA,EAAOC,EAAMC,EAAIC,GACtB,OAAOC,OAAOC,KAAMJ,OAAaK,OAAO,CAACC,EAAGC,KACxCD,EAAEC,GAAQN,EAAGD,EAAKO,GAAOA,EAAMD,GACxBA,GACPJ,OAGR,SAASM,EAAiBC,EAAQC,KAAeC,GAC7C,OAAOZ,EAAOW,EAAY,CAACE,EAAQL,EAAMM,IACf,mBAAXD,EAA8BH,EAAOG,EAAQC,KAAUF,GAC3DH,EAAiBC,EAAQG,KAAWD,EAAKG,IAAIC,GAAKA,EAAER,MAInE,SAASS,EAAYC,EAAMC,GACvB,OAAOnB,EAAOkB,EAAKE,IAAKA,GAAOhB,OAAOiB,UAAWJ,EAAYG,EAAKD,IAAQD,EAAKC,WAGpE,SAAUD,EAAMI,GAC3B,IAAIC,EAEJ,MAAMC,EAASC,IACPF,IACJA,GAAWA,EACXG,WAAWD,IACRF,GAAWA,EACXD,GAAUA,KACV,KAGDK,EAAQV,EAAYC,EAAM,SAE1BU,EAAUnB,EACZ,CAACP,EAAI0B,EAASD,IAAW,IAAIE,KACzB,IAAIC,EAAO5B,EAAGyB,EAAOC,KAAYC,GAC5BC,IACL1B,OAAOiB,OAAOM,EAAOG,GACrBN,MAEJP,EAAYC,EAAM,WAClBS,GAGEI,EAAQtB,EACV,CAACP,EAAI8B,EAAGC,EAAGC,IAAM,IAAIL,IAAS3B,EAAG+B,EAAGC,EAAGF,KAAMH,GAC7CZ,EAAYC,EAAM,SAClBS,EACAC,GAKJ,OAFAJ,KAEQI,QAAAA,EAASG,MAAAA"}