{"version":3,"file":"zx-app.umd.js","sources":["../src/index.js"],"sourcesContent":["function mapObj(orig, fn, onto) {\n    return Object.keys((orig || {})).reduce((o, name) => {\n        o[name] = fn(orig[name], name, o)\n        return o\n    }, (onto ||Â {}))\n} \n\nfunction bindFnCollection(binder, collection, ...more) {\n    return mapObj(collection, (toBind, name, bound) => {\n        if (typeof toBind === 'function') return binder(toBind, bound, ...more)\n        return bindFnCollection(binder, toBind, ...more.map(x => x[name]))\n    })\n}\n\nfunction collectSubs(opts, prop) {\n    return mapObj(opts.sub, sub => Object.assign({}, collectSubs(sub, prop)), opts[prop])\n}\n\nfunction onceNextTick (fn) {\n    var pending;\n    return _ => {\n        if (pending) return\n        pending = !pending\n        setTimeout(_ => {\n        pending = !pending\n        fn()\n        }, 0)\n    }\n}\n\nexport default function (opts, notify) {\n    \n    const update = onceNextTick(notify || (_ => {})) \n    const state = collectSubs(opts, 'state')\n\n    const actions = bindFnCollection(\n        (fn, A, S) =>  (...args) => {\n            var ret = fn(A, A, ...args)\n            if (!ret) return\n            Object.assign(state, ret)\n            update()\n        },\n        collectSubs(opts, 'actions'),\n        state\n    )\n\n    const views = bindFnCollection(\n        (fn, V, S, A) => (...args) => fn(S, A, V, ...args),\n        collectSubs(opts, 'views'),\n        state,\n        actions\n    )\n\n    update()\n    return {actions, views}\n}"],"names":["mapObj","orig","fn","onto","Object","keys","reduce","o","name","bindFnCollection","binder","collection","more","toBind","bound","map","x","collectSubs","opts","prop","sub","assign","notify","update","pending","_","setTimeout","onceNextTick","state","actions","A","S","args","ret","views","V"],"mappings":"oCAAA,SAASA,EAAOC,EAAMC,EAAIC,GACtB,OAAOC,OAAOC,KAAMJ,OAAaK,OAAO,CAACC,EAAGC,KACxCD,EAAEC,GAAQN,EAAGD,EAAKO,GAAOA,EAAMD,GACxBA,GACPJ,OAGR,SAASM,EAAiBC,EAAQC,KAAeC,GAC7C,OAAOZ,EAAOW,EAAY,CAACE,EAAQL,EAAMM,IACf,mBAAXD,EAA8BH,EAAOG,EAAQC,KAAUF,GAC3DH,EAAiBC,EAAQG,KAAWD,EAAKG,IAAIC,GAAKA,EAAER,MAInE,SAASS,EAAYC,EAAMC,GACvB,OAAOnB,EAAOkB,EAAKE,IAAKA,GAAOhB,OAAOiB,UAAWJ,EAAYG,EAAKD,IAAQD,EAAKC,WAepE,SAAUD,EAAMI,GAE3B,MAAMC,EAdV,SAAuBrB,GACnB,IAAIsB,EACJ,OAAOC,IACCD,IACJA,GAAWA,EACXE,WAAWD,IACXD,GAAWA,EACXtB,KACG,KAMQyB,CAAaL,IAAWG,QACjCG,EAAQX,EAAYC,EAAM,SAE1BW,EAAUpB,EACZ,CAACP,EAAI4B,EAAGC,IAAO,IAAIC,KACf,IAAIC,EAAM/B,EAAG4B,EAAGA,KAAME,GACjBC,IACL7B,OAAOiB,OAAOO,EAAOK,GACrBV,MAEJN,EAAYC,EAAM,WAClBU,GAGEM,EAAQzB,EACV,CAACP,EAAIiC,EAAGJ,EAAGD,IAAM,IAAIE,IAAS9B,EAAG6B,EAAGD,EAAGK,KAAMH,GAC7Cf,EAAYC,EAAM,SAClBU,EACAC,GAIJ,OADAN,KACQM,QAAAA,EAASK,MAAAA"}